### 本部分内容* 介绍 bash shell中的内部变量* 介绍shell处理字符串的命令和方法* 将原本无类型shell变量申明特定类型* 间接变量引用* bash数学运算### 9.1 内部变量* 内部变量是指能够对bash shell脚本行为产生影响的变量，它们对shell及其子shell都有效，因此内部变量属于环境变量的范畴1. `BASH`记录了`bash shell`的路径，通常为`/bin/bash`，内部变量`SHELL`就是通过`BASH`的值确定当前shell的类型2. `BASH_SUBSHELL`: 记录shell的层次3. `BASH_VERSINFO`:数组，6个元素，存储了bash的版本信息4. `BASH_VERSION`:5. `DIRSTACK`目录栈的栈顶值，    ```    # 目录栈用于存放工作目录，便于程序员手动控制目录的切换，pushed和popd用来维护目录栈。    # pushed命令：用于将某目录压入目录栈，同时将当前工作目录切换到入栈的目录。    # popd命令：用于将栈顶目录弹出，下一个元素变为栈顶元素，同时将当前工作目录切换到栈弹出的目录。        pushed 目录名  # 将目录名压入目录栈，同时当前工作目录切换到目录，并输出栈的内容    popd  # 将栈顶目录弹出，同时当前目录切换到栈弹出的目录，并输出栈的内容    dirs  # 用于显示目录栈的所有内容    ```    ```    pushd /home  # /home    pushd nihao  # /home /home/nihao    pushd /usr   # /home /home/nihao /usr    pushd wohao  # /home /home/nihao /usr /usr/wohao    ```6. `GLOBIGNORE`: 由冒号分隔的模式列表，表示通配时忽略的文件名集合    ```     # 一旦GLOBIGNORE非空，Shell会将通配得到的结果中符合GLOBIGNORE模式中的目录去掉。       ```7. `GROUPS`记录了当前用户所属的群组8. `HOSTNAME`记录了主机名9. HOSTTYPE和MACHTYPE:记录系统的硬件架构10. OSTYPE:记录操作系统类型11. ERPLY:与read和select命令有关    ```    # read 将读到的标准输入存储到variable变量中。    read variable  # 读取标准输入的变量值    # 当read命令不带任何变量名时，read就将读到的标准输入存储到REPLY变量中。    read    echo "$REPLY"  # 存储未指定变量的用户输入        read name    echo "$name"    echo "$REPLY"        # input_reply    # input_name    # input_reply    ```    ```    select var in "a" "b" "c"    do        echo "$REPLY"  # 存储用户的输入        echo "$var"        break    done    # #? 1    # 1    # a    ```12. SECONDS:记录脚本从开始执行到结束所耗费的时间13. SHELLOPTS:记录了处于“开”状态的Shell选项列表，是只读变量```set -o optionname  # 打开名为optionname选项set +o optionname  # 关闭名为optionname选项```### 9.2 字符串处理> bash shell 提供多种字符串处理命令，如awk命令，expr命令1. expr length:计算字符串长度    ```    ${#string}    expr length "$string"    ```    ```    string="a b c"    echo ${#string}    expr length "$string"    # 5    # 5    ```2. expr index:字符第一次出现的位置(索引)    ```    # 在$string上匹配$substring中字符第一次出现的位置，若匹配不到任何字符，expr index返回0    expr index $string $substring    ```    ```    string="nihao a"    expr index "$string" hao  # 3    expr index "$string" oah  # 3，oah中字符在string中第一次出现的位置    ```3. expr match:从开头开始匹配的字符个数    ```    # 从开头开始匹配，返回匹配的长度    expr match $string $substring  # substring可以是字符串，也可以是正则表达式    ```    ```    string="abc cba"    expr match "$string" a.*  # 7    expr match "$string" ab  # 2    expr match "$string" bc  # 0    ```4. expr substr:抽取子串    ```    # ${...}命令:    ${string:position}  # 从0开始计数    ${string:position:length}        # expr substr命令    expr substr $string $position $length  # $length必不可少，从1开始计数    ```    ```    string="abc def"    echo ${string:0}  # abc def    echo ${string:2}  # c def    echo ${string:2:3}  # c d    echo ${string: -2}  # ef,从右开始计数    echo ${string:(-2)}  # ef,从右开始计数，等价于上式        expr substr "$string" 1 3  # abc    ```5. 删除子串    ```    # 从头删除子串    ${string#substring}  # 删除匹配的最短子串    ${string##substring}  # 删除匹配的最长子串        # 从结尾处删除子串    ${string%substring}  # 删除匹配的最短子串    ${string%%substring}  # 删除匹配的最长子串    ```    ```    string="1234234"    echo ${string#1*2}  # 34234    echo ${string##1*2}  # 34    echo ${string%2*4}  # 1234    echo ${string%%2*4}  # 1    ```6. 替换子串    ```    ${string/substring/replacement}  # 仅替换第一次匹配的子串    ${string//substring/replacement}  # 替换所有匹配的子串        ${string/#substring/replacement}  # 仅在开头处替换    ${string/%substring/replacement}  # 仅在结尾处替换    ```### 9.3 有类型变量> shell变量一般是无类型的，但是shell提供了declare和typeset两个命令用于指定变量的类型，这两个命令等价。```declare [选项] 变量名```* -r:设置为只读    ```    declare -r variable    readonly variable        ```* -i:将变量定义为整型（允许使用该变量进行算术运算）    ```    variable1=12    variable2="$variable1"+1    echo "$variable2"  # 12+1        let variable3=$variable1+1    echo "$variable3"  # 13        declare -i variable4  # 将variable4定义为整型变量    variable4="$variable1"+1    echo "$variable4"  # 13        variable5=$((variable1+1))  # 双圆括号法(())执行运算    echo "$variable5"  # 13    ```* -f:显示脚本之前定义过的所有函数名及其内容    ```    declare -f  # 显示脚本之前定义过的所有函数名及其内容    declare -f function-name  # 只显示function-name及其内容    ```* -x:将变量声明为环境变量    ```    # 相当于export命令    # declare -x 允许在声明变量为环境变量的同时给变量赋值，而export不支持此功能。    declare -x variable-name=value    ```### 9.4 间接变量引用> 间接变量引用：一个变量引用另一个变量的值```variable1=valuevariable2=variable1eval tmp_var=\$$variable2  # valuetmp_var=${!variable2}  # value```### 9.5 bash数学运算* expr命令```expr ARG1 op ARG2expr 3 | 2  # 3expr 0 | 2  # 2，ARG1不为空且非零时，返回ARG1，否则返回ARG2expr 3 & 2  # 3，ARG1不为空且非零时，返回ARG1，否则返回0expr 0 & 2  # 0，ARG1不为空且非零时，返回ARG1，否则返回0expr 1 > 2  # 0，假expr 1 < 2  # 1，真expr 1 >= 2  # 0expr 1 <= 2  # 1expr 1 = 2  # 0expr 1 != 2  # 1expr 1 + 2  # 3，运算符前后需要有空格expr 2 - 1  # 1expr 1 \* 2  # 2，*为元字符，需要转义expr 2 / 1  # 2expr 2 % 1  # 0```